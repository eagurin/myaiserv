#!/bin/bash
# Скрипт для запуска реструктуризации проекта

set -e  # Остановка при ошибке

# Определяем цвета для вывода
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[0;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}=== Запуск процесса реструктуризации проекта ===${NC}"

# Проверяем наличие Python и других зависимостей
python_version=$(python -V 2>&1 | cut -d" " -f2)
echo -e "Используем Python: ${GREEN}$python_version${NC}"

# Проверяем, что мы находимся в корне проекта
if [ ! -d "src" ] || [ ! -d "tests" ]; then
    echo -e "${RED}Ошибка: Скрипт должен быть запущен из корня проекта${NC}"
    echo -e "${RED}Директории src и tests должны существовать${NC}"
    exit 1
fi

# Проверяем, что скрипт реструктуризации существует
if [ ! -f "scripts/restructure_project.py" ]; then
    echo -e "${RED}Ошибка: Скрипт restructure_project.py не найден${NC}"
    echo -e "${RED}Убедитесь, что вы создали все необходимые скрипты${NC}"
    exit 1
fi

# Запускаем основной скрипт реструктуризации
echo -e "${YELLOW}Запуск основного скрипта реструктуризации...${NC}"
python scripts/restructure_project.py

# Проверяем код возврата
if [ $? -ne 0 ]; then
    echo -e "${RED}Ошибка при выполнении реструктуризации!${NC}"
    echo -e "${YELLOW}Проверьте вывод выше для деталей.${NC}"
    exit 1
fi

# Запускаем форматирование кода
echo -e "${YELLOW}Форматирование кода после реструктуризации...${NC}"
bash scripts/format_code.sh

echo -e "${GREEN}=== Реструктуризация проекта успешно завершена ===${NC}"
echo -e "${YELLOW}Рекомендуемые действия:${NC}"
echo -e "1. Запустите тесты: ${GREEN}pytest${NC}"
echo -e "2. Проверьте работу приложения"
echo -e "3. Если всё работает корректно, удалите директорию src/app"

exit 0
